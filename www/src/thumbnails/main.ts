
// polyfill
import 'whatwg-fetch'
import 'regenerator-runtime/runtime' // https://github.com/parcel-bundler/parcel/issues/3375

// styles
import '../styles.scss'

import { Polygon } from './types'
import { getPolygonSVGDefinition, getThumbnail } from './thumbnailGenerator'
import { thumbnailConfig } from './config'

generateThumbnails()

function generateThumbnails() {
  let thumbnailWidth = 100 // in pixels
  let thumbnailHeight = 100

  let showPolygonOutline = true

  let s1FrameIds = [
    'S1A_20200104_132_asc_175012_175037_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200209_132_asc_175011_175036_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200304_132_asc_175011_175036_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200421_132_asc_175013_175038_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200503_132_asc_175014_175039_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200608_132_asc_175016_175041_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200726_132_asc_175019_175044_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20200807_132_asc_175020_175045_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1B_20200906_132_asc_174932_174957_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1B_20201024_132_asc_174932_174957_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1B_20201129_132_asc_174932_174957_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE',
    'S1A_20201229_132_asc_175020_175045_VVVH_G0_GB_OSGB_RTCK_SpkRL_SE'
  ]
  let s2FrameIds = [
    'S2A_20200120_lat54lon066_T30UXE_ORB037_utm30n_osgb',
    'S2A_20200206_lat54lon066_T30UXE_ORB137_utm30n_osgb',
    'S2B_20200325_lat54lon066_T30UXE_ORB037_utm30n_osgb',
    'S2B_20200421_lat54lon066_T30UXE_ORB137_utm30n_osgb',
    'S2B_20200531_lat54lon066_T30UXE_ORB137_utm30n_osgb',
    'S2A_20200728_lat54lon066_T30UXE_ORB037_utm30n_osgb',
    'S2A_20200807_lat54lon066_T30UXE_ORB037_utm30n_osgb'
  ]

  let polygons : Polygon[] = [
    {
      'polygonId': '507742',
      'coordinates': [ [ [ [ 471560.0, 439950.0 ], [ 471550.0, 439950.0 ], [ 471550.0, 439960.0 ], [ 471540.0, 439960.0 ], [ 471540.0, 439980.0 ], [ 471530.0, 439980.0 ], [ 471530.0, 439990.0 ], [ 471520.0, 439990.0 ], [ 471520.0, 440010.0 ], [ 471510.0, 440010.0 ], [ 471510.0, 440040.0 ], [ 471500.0, 440040.0 ], [ 471500.0, 440050.0 ], [ 471490.0, 440050.0 ], [ 471490.0, 440070.0 ], [ 471480.0, 440070.0 ], [ 471480.0, 440080.0 ], [ 471470.0, 440080.0 ], [ 471470.0, 440090.0 ], [ 471460.0, 440090.0 ], [ 471460.0, 440120.0 ], [ 471440.0, 440120.0 ], [ 471440.0, 440160.0 ], [ 471420.0, 440160.0 ], [ 471420.0, 440180.0 ], [ 471410.0, 440180.0 ], [ 471410.0, 440190.0 ], [ 471400.0, 440190.0 ], [ 471400.0, 440210.0 ], [ 471390.0, 440210.0 ], [ 471390.0, 440220.0 ], [ 471380.0, 440220.0 ], [ 471380.0, 440240.0 ], [ 471370.0, 440240.0 ], [ 471370.0, 440260.0 ], [ 471360.0, 440260.0 ], [ 471360.0, 440270.0 ], [ 471340.0, 440270.0 ], [ 471340.0, 440310.0 ], [ 471330.0, 440310.0 ], [ 471330.0, 440320.0 ], [ 471320.0, 440320.0 ], [ 471320.0, 440340.0 ], [ 471310.0, 440340.0 ], [ 471310.0, 440350.0 ], [ 471300.0, 440350.0 ], [ 471300.0, 440360.0 ], [ 471290.0, 440360.0 ], [ 471290.0, 440380.0 ], [ 471280.0, 440380.0 ], [ 471280.0, 440400.0 ], [ 471270.0, 440400.0 ], [ 471270.0, 440420.0 ], [ 471290.0, 440420.0 ], [ 471320.0, 440420.0 ], [ 471320.0, 440430.0 ], [ 471340.0, 440430.0 ], [ 471340.0, 440440.0 ], [ 471370.0, 440440.0 ], [ 471370.0, 440450.0 ], [ 471390.0, 440450.0 ], [ 471390.0, 440480.0 ], [ 471410.0, 440480.0 ], [ 471410.0, 440500.0 ], [ 471440.0, 440500.0 ], [ 471440.0, 440510.0 ], [ 471450.0, 440510.0 ], [ 471450.0, 440520.0 ], [ 471460.0, 440520.0 ], [ 471460.0, 440530.0 ], [ 471490.0, 440530.0 ], [ 471490.0, 440520.0 ], [ 471500.0, 440520.0 ], [ 471500.0, 440500.0 ], [ 471510.0, 440500.0 ], [ 471510.0, 440490.0 ], [ 471520.0, 440490.0 ], [ 471520.0, 440470.0 ], [ 471530.0, 440470.0 ], [ 471530.0, 440450.0 ], [ 471540.0, 440450.0 ], [ 471540.0, 440440.0 ], [ 471550.0, 440440.0 ], [ 471550.0, 440420.0 ], [ 471560.0, 440420.0 ], [ 471560.0, 440380.0 ], [ 471570.0, 440380.0 ], [ 471570.0, 440360.0 ], [ 471590.0, 440360.0 ], [ 471590.0, 440390.0 ], [ 471600.0, 440390.0 ], [ 471600.0, 440400.0 ], [ 471630.0, 440400.0 ], [ 471630.0, 440410.0 ], [ 471650.0, 440410.0 ], [ 471650.0, 440420.0 ], [ 471660.0, 440420.0 ], [ 471660.0, 440430.0 ], [ 471680.0, 440430.0 ], [ 471680.0, 440440.0 ], [ 471680.0, 440450.0 ], [ 471700.0, 440450.0 ], [ 471700.0, 440460.0 ], [ 471730.0, 440460.0 ], [ 471730.0, 440470.0 ], [ 471740.0, 440470.0 ], [ 471740.0, 440480.0 ], [ 471750.0, 440480.0 ], [ 471750.0, 440490.0 ], [ 471770.0, 440490.0 ], [ 471770.0, 440500.0 ], [ 471780.0, 440500.0 ], [ 471780.0, 440510.0 ], [ 471830.0, 440510.0 ], [ 471830.0, 440520.0 ], [ 471850.0, 440520.0 ], [ 471850.0, 440530.0 ], [ 471860.0, 440530.0 ], [ 471860.0, 440540.0 ], [ 471870.0, 440540.0 ], [ 471870.0, 440550.0 ], [ 471880.0, 440550.0 ], [ 471880.0, 440560.0 ], [ 471890.0, 440560.0 ], [ 471890.0, 440570.0 ], [ 471910.0, 440570.0 ], [ 471910.0, 440580.0 ], [ 471930.0, 440580.0 ], [ 471930.0, 440590.0 ], [ 471950.0, 440590.0 ], [ 471950.0, 440600.0 ], [ 471960.0, 440600.0 ], [ 471960.0, 440610.0 ], [ 472010.0, 440610.0 ], [ 472010.0, 440620.0 ], [ 472020.0, 440620.0 ], [ 472020.0, 440630.0 ], [ 472040.0, 440630.0 ], [ 472040.0, 440650.0 ], [ 472050.0, 440650.0 ], [ 472050.0, 440630.0 ], [ 472070.0, 440630.0 ], [ 472080.0, 440630.0 ], [ 472080.0, 440620.0 ], [ 472090.0, 440620.0 ], [ 472090.0, 440610.0 ], [ 472100.0, 440610.0 ], [ 472100.0, 440600.0 ], [ 472110.0, 440600.0 ], [ 472110.0, 440590.0 ], [ 472120.0, 440590.0 ], [ 472120.0, 440570.0 ], [ 472130.0, 440570.0 ], [ 472130.0, 440560.0 ], [ 472160.0, 440560.0 ], [ 472160.0, 440540.0 ], [ 472170.0, 440540.0 ], [ 472170.0, 440510.0 ], [ 472180.0, 440510.0 ], [ 472180.0, 440450.0 ], [ 472180.0, 440410.0 ], [ 472190.0, 440410.0 ], [ 472190.0, 440390.0 ], [ 472170.0, 440390.0 ], [ 472170.0, 440380.0 ], [ 472160.0, 440380.0 ], [ 472160.0, 440370.0 ], [ 472140.0, 440370.0 ], [ 472140.0, 440360.0 ], [ 472130.0, 440360.0 ], [ 472130.0, 440350.0 ], [ 472120.0, 440350.0 ], [ 472120.0, 440340.0 ], [ 472100.0, 440340.0 ], [ 472100.0, 440330.0 ], [ 472070.0, 440330.0 ], [ 472070.0, 440310.0 ], [ 472060.0, 440310.0 ], [ 472060.0, 440300.0 ], [ 472020.0, 440300.0 ], [ 472020.0, 440290.0 ], [ 472000.0, 440290.0 ], [ 472000.0, 440280.0 ], [ 471990.0, 440280.0 ], [ 471990.0, 440270.0 ], [ 471950.0, 440270.0 ], [ 471950.0, 440260.0 ], [ 471940.0, 440260.0 ], [ 471940.0, 440250.0 ], [ 471930.0, 440250.0 ], [ 471930.0, 440240.0 ], [ 471900.0, 440240.0 ], [ 471900.0, 440230.0 ], [ 471890.0, 440230.0 ], [ 471890.0, 440220.0 ], [ 471870.0, 440220.0 ], [ 471870.0, 440210.0 ], [ 471840.0, 440210.0 ], [ 471840.0, 440200.0 ], [ 471820.0, 440200.0 ], [ 471820.0, 440190.0 ], [ 471810.0, 440190.0 ], [ 471810.0, 440180.0 ], [ 471800.0, 440180.0 ], [ 471800.0, 440170.0 ], [ 471780.0, 440170.0 ], [ 471780.0, 440160.0 ], [ 471760.0, 440160.0 ], [ 471760.0, 440150.0 ], [ 471750.0, 440150.0 ], [ 471750.0, 440140.0 ], [ 471730.0, 440140.0 ], [ 471730.0, 440130.0 ], [ 471720.0, 440130.0 ], [ 471720.0, 440120.0 ], [ 471680.0, 440120.0 ], [ 471680.0, 440100.0 ], [ 471670.0, 440100.0 ], [ 471650.0, 440100.0 ], [ 471650.0, 440090.0 ], [ 471640.0, 440090.0 ], [ 471640.0, 440080.0 ], [ 471620.0, 440080.0 ], [ 471620.0, 440070.0 ], [ 471600.0, 440070.0 ], [ 471600.0, 440060.0 ], [ 471590.0, 440060.0 ], [ 471590.0, 440050.0 ], [ 471580.0, 440050.0 ], [ 471580.0, 440040.0 ], [ 471560.0, 440040.0 ], [ 471560.0, 440030.0 ], [ 471540.0, 440030.0 ], [ 471540.0, 440020.0 ], [ 471530.0, 440020.0 ], [ 471530.0, 440000.0 ], [ 471540.0, 440000.0 ], [ 471540.0, 439990.0 ], [ 471550.0, 439990.0 ], [ 471550.0, 439970.0 ], [ 471560.0, 439970.0 ], [ 471560.0, 439950.0 ] ] ] ]
    },
    // {
    //   'polygonId': '581822', // long thin motorway
    //   'coordinates': [ [ [ [ 467070.0, 409640.0 ], [ 467050.0, 409640.0 ], [ 467050.0, 409600.0 ], [ 467040.0, 409600.0 ], [ 467040.0, 409560.0 ], [ 467020.0, 409560.0 ], [ 467020.0, 409530.0 ], [ 467010.0, 409530.0 ], [ 467010.0, 409520.0 ], [ 466980.0, 409520.0 ], [ 466980.0, 409530.0 ], [ 466990.0, 409530.0 ], [ 466990.0, 409560.0 ], [ 467000.0, 409560.0 ], [ 467000.0, 409580.0 ], [ 467010.0, 409580.0 ], [ 467010.0, 409590.0 ], [ 467020.0, 409590.0 ], [ 467020.0, 409640.0 ], [ 467040.0, 409640.0 ], [ 467040.0, 409670.0 ], [ 467050.0, 409670.0 ], [ 467050.0, 409690.0 ], [ 467070.0, 409690.0 ], [ 467070.0, 409730.0 ], [ 467080.0, 409730.0 ], [ 467080.0, 409780.0 ], [ 467090.0, 409780.0 ], [ 467090.0, 409800.0 ], [ 467100.0, 409800.0 ], [ 467100.0, 409820.0 ], [ 467110.0, 409820.0 ], [ 467110.0, 409850.0 ], [ 467120.0, 409850.0 ], [ 467120.0, 409870.0 ], [ 467130.0, 409870.0 ], [ 467130.0, 409880.0 ], [ 467140.0, 409880.0 ], [ 467140.0, 409910.0 ], [ 467160.0, 409910.0 ], [ 467160.0, 409960.0 ], [ 467170.0, 409960.0 ], [ 467170.0, 409980.0 ], [ 467180.0, 409980.0 ], [ 467180.0, 410000.0 ], [ 467190.0, 410000.0 ], [ 467190.0, 410040.0 ], [ 467200.0, 410040.0 ], [ 467200.0, 410060.0 ], [ 467210.0, 410060.0 ], [ 467210.0, 410090.0 ], [ 467220.0, 410090.0 ], [ 467220.0, 410150.0 ], [ 467230.0, 410150.0 ], [ 467230.0, 410200.0 ], [ 467240.0, 410200.0 ], [ 467240.0, 410210.0 ], [ 467250.0, 410210.0 ], [ 467250.0, 410540.0 ], [ 467230.0, 410540.0 ], [ 467230.0, 410590.0 ], [ 467220.0, 410590.0 ], [ 467220.0, 410630.0 ], [ 467210.0, 410630.0 ], [ 467210.0, 410660.0 ], [ 467200.0, 410660.0 ], [ 467200.0, 410690.0 ], [ 467190.0, 410690.0 ], [ 467190.0, 410710.0 ], [ 467180.0, 410710.0 ], [ 467180.0, 410740.0 ], [ 467170.0, 410740.0 ], [ 467170.0, 410760.0 ], [ 467160.0, 410760.0 ], [ 467160.0, 410790.0 ], [ 467140.0, 410790.0 ], [ 467140.0, 410810.0 ], [ 467130.0, 410810.0 ], [ 467130.0, 410830.0 ], [ 467120.0, 410830.0 ], [ 467120.0, 410850.0 ], [ 467110.0, 410850.0 ], [ 467110.0, 410870.0 ], [ 467100.0, 410870.0 ], [ 467100.0, 410880.0 ], [ 467090.0, 410880.0 ], [ 467090.0, 410890.0 ], [ 467080.0, 410890.0 ], [ 467080.0, 410910.0 ], [ 467070.0, 410910.0 ], [ 467070.0, 410920.0 ], [ 467050.0, 410920.0 ], [ 467050.0, 410930.0 ], [ 467040.0, 410930.0 ], [ 467040.0, 410940.0 ], [ 467030.0, 410940.0 ], [ 467030.0, 410950.0 ], [ 467020.0, 410950.0 ], [ 467020.0, 410960.0 ], [ 467010.0, 410960.0 ], [ 467010.0, 410970.0 ], [ 466980.0, 410970.0 ], [ 466980.0, 411000.0 ], [ 467000.0, 411000.0 ], [ 467000.0, 411050.0 ], [ 467010.0, 411050.0 ], [ 467010.0, 411060.0 ], [ 467020.0, 411060.0 ], [ 467020.0, 411070.0 ], [ 467030.0, 411070.0 ], [ 467030.0, 411090.0 ], [ 467040.0, 411090.0 ], [ 467040.0, 411290.0 ], [ 467050.0, 411290.0 ], [ 467050.0, 411280.0 ], [ 467070.0, 411280.0 ], [ 467070.0, 411200.0 ], [ 467080.0, 411200.0 ], [ 467080.0, 411180.0 ], [ 467090.0, 411180.0 ], [ 467090.0, 411140.0 ], [ 467130.0, 411140.0 ], [ 467130.0, 411150.0 ], [ 467120.0, 411150.0 ], [ 467120.0, 411200.0 ], [ 467110.0, 411200.0 ], [ 467110.0, 411220.0 ], [ 467100.0, 411220.0 ], [ 467100.0, 411270.0 ], [ 467090.0, 411270.0 ], [ 467090.0, 411330.0 ], [ 467100.0, 411330.0 ], [ 467100.0, 411300.0 ], [ 467110.0, 411300.0 ], [ 467110.0, 411280.0 ], [ 467120.0, 411280.0 ], [ 467120.0, 411240.0 ], [ 467130.0, 411240.0 ], [ 467130.0, 411230.0 ], [ 467140.0, 411230.0 ], [ 467140.0, 411200.0 ], [ 467160.0, 411200.0 ], [ 467160.0, 411160.0 ], [ 467170.0, 411160.0 ], [ 467170.0, 411150.0 ], [ 467190.0, 411150.0 ], [ 467190.0, 411140.0 ], [ 467200.0, 411140.0 ], [ 467200.0, 411130.0 ], [ 467220.0, 411130.0 ], [ 467220.0, 411120.0 ], [ 467250.0, 411120.0 ], [ 467250.0, 411110.0 ], [ 467280.0, 411110.0 ], [ 467280.0, 411100.0 ], [ 467370.0, 411100.0 ], [ 467370.0, 411090.0 ], [ 467340.0, 411090.0 ], [ 467340.0, 411060.0 ], [ 467350.0, 411060.0 ], [ 467350.0, 411050.0 ], [ 467340.0, 411050.0 ], [ 467340.0, 411040.0 ], [ 467310.0, 411040.0 ], [ 467310.0, 411030.0 ], [ 467300.0, 411030.0 ], [ 467300.0, 411020.0 ], [ 467290.0, 411020.0 ], [ 467290.0, 411010.0 ], [ 467280.0, 411010.0 ], [ 467280.0, 411000.0 ], [ 467270.0, 411000.0 ], [ 467270.0, 410980.0 ], [ 467260.0, 410980.0 ], [ 467260.0, 410970.0 ], [ 467250.0, 410970.0 ], [ 467250.0, 410940.0 ], [ 467230.0, 410940.0 ], [ 467230.0, 410770.0 ], [ 467250.0, 410770.0 ], [ 467250.0, 410750.0 ], [ 467250.0, 410690.0 ], [ 467260.0, 410690.0 ], [ 467260.0, 410630.0 ], [ 467270.0, 410630.0 ], [ 467270.0, 410580.0 ], [ 467280.0, 410580.0 ], [ 467280.0, 410520.0 ], [ 467290.0, 410520.0 ], [ 467290.0, 410270.0 ], [ 467280.0, 410270.0 ], [ 467280.0, 410170.0 ], [ 467270.0, 410170.0 ], [ 467270.0, 410130.0 ], [ 467260.0, 410130.0 ], [ 467260.0, 410110.0 ], [ 467250.0, 410110.0 ], [ 467250.0, 410050.0 ], [ 467230.0, 410050.0 ], [ 467230.0, 410000.0 ], [ 467210.0, 410000.0 ], [ 467210.0, 409960.0 ], [ 467200.0, 409960.0 ], [ 467200.0, 409950.0 ], [ 467190.0, 409950.0 ], [ 467190.0, 409910.0 ], [ 467170.0, 409910.0 ], [ 467170.0, 409880.0 ], [ 467160.0, 409880.0 ], [ 467160.0, 409820.0 ], [ 467140.0, 409820.0 ], [ 467140.0, 409810.0 ], [ 467130.0, 409810.0 ], [ 467130.0, 409780.0 ], [ 467120.0, 409780.0 ], [ 467120.0, 409770.0 ], [ 467110.0, 409770.0 ], [ 467110.0, 409740.0 ], [ 467100.0, 409740.0 ], [ 467100.0, 409720.0 ], [ 467090.0, 409720.0 ], [ 467090.0, 409710.0 ], [ 467080.0, 409710.0 ], [ 467080.0, 409680.0 ], [ 467070.0, 409680.0 ], [ 467070.0, 409650.0 ], [ 467070.0, 409640.0 ] ], [ [ 467070.0, 411090.0 ], [ 467070.0, 411070.0 ], [ 467050.0, 411070.0 ], [ 467050.0, 411060.0 ], [ 467040.0, 411060.0 ], [ 467040.0, 411040.0 ], [ 467030.0, 411040.0 ], [ 467030.0, 410970.0 ], [ 467040.0, 410970.0 ], [ 467040.0, 410960.0 ], [ 467050.0, 410960.0 ], [ 467050.0, 410950.0 ], [ 467070.0, 410950.0 ], [ 467070.0, 410940.0 ], [ 467130.0, 410940.0 ], [ 467130.0, 410980.0 ], [ 467120.0, 410980.0 ], [ 467120.0, 411010.0 ], [ 467110.0, 411010.0 ], [ 467110.0, 411060.0 ], [ 467100.0, 411060.0 ], [ 467100.0, 411090.0 ], [ 467070.0, 411090.0 ] ], [ [ 467140.0, 411110.0 ], [ 467140.0, 411090.0 ], [ 467160.0, 411090.0 ], [ 467160.0, 411030.0 ], [ 467170.0, 411030.0 ], [ 467170.0, 410970.0 ], [ 467200.0, 410970.0 ], [ 467200.0, 410980.0 ], [ 467210.0, 410980.0 ], [ 467210.0, 410990.0 ], [ 467220.0, 410990.0 ], [ 467220.0, 411040.0 ], [ 467230.0, 411040.0 ], [ 467230.0, 411050.0 ], [ 467240.0, 411050.0 ], [ 467240.0, 411070.0 ], [ 467230.0, 411070.0 ], [ 467230.0, 411090.0 ], [ 467210.0, 411090.0 ], [ 467210.0, 411100.0 ], [ 467190.0, 411100.0 ], [ 467190.0, 411110.0 ], [ 467140.0, 411110.0 ] ] ] ]
    // }
  ]

  console.log(`Generating thumbnails for ${polygons.length} polygons for ${s1FrameIds.length} S1 frames and ${s2FrameIds.length} S2 frames`)
  console.log(`Current entries in cache: ${window.sessionStorage.length}`)

  polygons.forEach((polygon) => {
    let polygonId = polygon['polygonId']

    // generate a hidden SVG polygon definition/template for the outlines and put it somewhere in the document
    let body = document.body
    let svgOutline = getPolygonSVGDefinition(polygon, thumbnailWidth, thumbnailHeight)
    body.prepend(svgOutline)

    s1FrameIds.forEach(frameId => {
      let s1FalseColourDiv = <HTMLDivElement> document.getElementById('s1_false_colour')
      getThumbnail(frameId, polygon, thumbnailConfig.falseColour).then(thumbnailString => {
        displayThumbnail(s1FalseColourDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)
      })
  
      let s1RVIDiv = <HTMLDivElement> document.getElementById('s1_rvi')
      getThumbnail(frameId, polygon, thumbnailConfig.rvi).then(thumbnailString => {
        displayThumbnail(s1RVIDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)     
      })
  
      let s1RVIvDiv = <HTMLDivElement> document.getElementById('s1_rviv')
      getThumbnail(frameId, polygon, thumbnailConfig.rviv).then(thumbnailString => {
        displayThumbnail(s1RVIvDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)      
      })
    })

    s2FrameIds.forEach(frameId => {
      let s2TrueColourDiv = <HTMLDivElement> document.getElementById('s2_true_colour')
      getThumbnail(frameId, polygon, thumbnailConfig.falseColour).then(thumbnailString => {
        displayThumbnail(s2TrueColourDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)     
      })
  
      let s2NDMIDiv = <HTMLDivElement> document.getElementById('s2_ndmi')
      getThumbnail(frameId, polygon, thumbnailConfig.ndmi).then(thumbnailString => {
        displayThumbnail(s2NDMIDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)
      })
  
      let s2NDVIDiv = <HTMLDivElement> document.getElementById('s2_ndvi')
      getThumbnail(frameId, polygon, thumbnailConfig.ndvi).then(thumbnailString => {
        displayThumbnail(s2NDVIDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)       
      })
  
      let s2NDWIDiv = <HTMLDivElement> document.getElementById('s2_ndwi')
      getThumbnail(frameId, polygon, thumbnailConfig.ndwi).then(thumbnailString => {
        displayThumbnail(s2NDWIDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)
      })
  
      let s2EVIDiv = <HTMLDivElement> document.getElementById('s2_evi')
      getThumbnail(frameId, polygon, thumbnailConfig.evi).then(thumbnailString => {
        displayThumbnail(s2EVIDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline)      
      })
  
      let s2NBRDiv = <HTMLDivElement>  document.getElementById('s2_nbr')
      getThumbnail(frameId, polygon, thumbnailConfig.nbr).then(thumbnailString => {
        displayThumbnail(s2NBRDiv, frameId, thumbnailString, polygonId, thumbnailWidth, thumbnailHeight, showPolygonOutline) 
      })
    })
  })
  
}

function displayThumbnail(div : HTMLElement, frameId : string, thumbnailString : string, polygonId : string, thumbnailWidth : number, thumbnailHeight: number, showPolygonOutline : boolean) {
  // arranging HTML elements to display the thumbnail image and SVG outline together
  
  let thumbnailDiv = document.createElement('div')
  thumbnailDiv.className = 'thumbnail-overlay'

  let imageElement = new Image(thumbnailWidth, thumbnailHeight)
  imageElement.src = thumbnailString

  thumbnailDiv.appendChild(imageElement)

  if (showPolygonOutline) {
    // create an SVG using the polygon definition created earlier
    let svgNS = 'http://www.w3.org/2000/svg'
    let svgElement = document.createElementNS(svgNS, 'svg')
  
    let useElement = document.createElementNS(svgNS,'use')
    useElement.setAttribute('href', `#polygon_outline_${polygonId}`)
  
    svgElement.appendChild(useElement)
    thumbnailDiv.appendChild(svgElement)
  }

  let thumbnailLabel = document.createElement('div')
  let date = frameId.substring(4, 12)
  thumbnailLabel.textContent = date
  thumbnailDiv.appendChild(thumbnailLabel)

  div.appendChild(thumbnailDiv)
}

